<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../laxar.theme/img/favicon.ico">
        <title>LaxarJS Patterns  v1.1.0</title>

        <link rel="stylesheet" href="../../../laxar.theme/css/pygments.css">
        <link href="../../../laxar.theme/css/style.min.css" rel="stylesheet">

    </head>

    <body class="documentation">

      <header class="navbar  navbar-fixed-top" role="navigation">
    <div class="container">

        <div class="navbar-header navbar-inverse">
           <button class="navbar-toggle"
              type="button"
              data-toggle="collapse"
              data-target=".navbar-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
          </button>
            <!-- Main title -->
            <a class="navbar-brand" href="http://www.laxarjs.org">
               <span class="ax-laxar-logo">Laxar<span>JS</span></span>
            </a>
         </div>

         <div class="navbar-collapse collapse navbar-inverse">
            <ul class="nav navbar-nav nav-pills ax-dropdown">
   <li role="presentation" class="dropdown">
      <a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">
         laxar-patterns <span class="caret"></span>
      </a>
         
         <ul class="dropdown-menu">
            
            <li><a href="../../../laxar-latest">laxar</a></li>
            
            <li><a href="../../../laxar-patterns-latest">laxar-patterns</a></li>
            
            <li><a href="../../../laxar-uikit-latest">laxar-uikit</a></li>
            
            <li><a href="../../../laxar-mocks-latest">laxar-mocks</a></li>
            
            <li><a href="../../../laxar-loader-latest">laxar-loader</a></li>
            
            <li><a href="../../../laxar-tooling-latest">laxar-tooling</a></li>
            
            <li><a href="../../../laxar-angular-adapter-latest">laxar-angular-adapter</a></li>
            
            <li><a href="../../../laxar-angular2-adapter-latest">laxar-angular2-adapter</a></li>
            
            <li><a href="../../../laxar-react-adapter-latest">laxar-react-adapter</a></li>
            
            <li><a href="../../../laxar-vue-adapter-latest">laxar-vue-adapter</a></li>
            
            <li><a href="../../../generator-laxarjs-latest">generator-laxarjs</a></li>
            
            <li><a href="../../../generator-laxarjs2-latest">generator-laxarjs2</a></li>
            
            <li><a href="../../../grunt-laxar-latest">grunt-laxar</a></li>
            
         </ul>
         
   </li>
</ul>
            <ul class="nav navbar-nav nav-pills ax-dropdown">
   <li role="presentation" class="dropdown">
      <a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">
         v1.1.0 <span class="caret"></span>
      </a>
      
      <ul class="dropdown-menu">
         
            <li class="ax-dropdown-headline">Latest</li>
            
               <li><a href="../../../laxar-patterns-v2-latest">v2.0.0</a></li>
            
               <li><a href="../../../laxar-patterns-v1-latest">v1.3.0</a></li>
            
               <li><a href="../../../laxar-patterns-v0-latest">v0.20.0</a></li>
            
            <li role="separator" class="divider"></li>
         
         <li class="ax-dropdown-headline">All Releases</li>
         
            <li><a href="../../../laxar-patterns-v2.0.0">v2.0.0</a></li>
         
            <li><a href="../../../laxar-patterns-v1.3.0">v1.3.0</a></li>
         
            <li><a href="../../../laxar-patterns-v1.2.0">v1.2.0</a></li>
         
            <li><a href="../../../laxar-patterns-v1.1.2">v1.1.2</a></li>
         
            <li><a href="../../../laxar-patterns-v1.1.1">v1.1.1</a></li>
         
            <li><a href="../../../laxar-patterns-v1.1.0">v1.1.0</a></li>
         
            <li><a href="../../../laxar-patterns-v1.0.1">v1.0.1</a></li>
         
            <li><a href="../../../laxar-patterns-v1.0.0">v1.0.0</a></li>
         
            <li><a href="../../../laxar-patterns-v0.20.0">v0.20.0</a></li>
         
            <li><a href="../../../laxar-patterns-v0.19.0">v0.19.0</a></li>
         
            <li><a href="../../../laxar-patterns-v0.18.1">v0.18.1</a></li>
         
            <li><a href="../../../laxar-patterns-v0.18.0">v0.18.0</a></li>
         
            <li><a href="../../../laxar-patterns-v0.17.0">v0.17.0</a></li>
         
            <li><a href="../../../laxar-patterns-v0.16.0">v0.16.0</a></li>
         
            <li><a href="../../../laxar-patterns-v0.15.0">v0.15.0</a></li>
         
            <li><a href="../../../laxar-patterns-v0.14.1">v0.14.1</a></li>
         
            <li><a href="../../../laxar-patterns-v0.14.0">v0.14.0</a></li>
         
            <li><a href="../../../laxar-patterns-v0.13.0">v0.13.0</a></li>
         
            <li><a href="../../../laxar-patterns-v0.12.1">v0.12.1</a></li>
         
            <li><a href="../../../laxar-patterns-v0.12.0">v0.12.0</a></li>
         
            <li><a href="../../../laxar-patterns-v0.11.1">v0.11.1</a></li>
         
            <li><a href="../../../laxar-patterns-v0.11.0">v0.11.0</a></li>
         
            <li><a href="../../../laxar-patterns-v0.10.1">v0.10.1</a></li>
         
            <li><a href="../../../laxar-patterns-v0.10.0">v0.10.0</a></li>
         
            <li><a href="../../../laxar-patterns-v0.9.2">v0.9.2</a></li>
         
            <li><a href="../../../laxar-patterns-v0.9.1">v0.9.1</a></li>
         
            <li><a href="../../../laxar-patterns-v0.9.0">v0.9.0</a></li>
         
      </ul>
      
   </li>
</ul>

            <ul class="nav navbar-nav">
               
                  
               
                  
                     <li >
                        <a href="../../CHANGELOG/">Changelog</a>
                     </li>
                  
               
                  
               
                  
               
               
                <!-- Repo link -->
                
                <li>
                    <a class="ax-external" href="https://github.com/LaxarJS/laxar-patterns/tree/v1.1.0">
                       <i class="fa fa-github"></i> GitHub
                    </a>
                </li>
                
            </ul>
            <a class="ax-navbar-additional"
               target="_blank"
               href="http://laxarjs.github.io/widget-browser/#/widgetBrowser">Widgets</a>
        </div>
    </div>
</header>

      <div class="container content">
        <div class="row">
           <sidebar class="col-sm-4 col-xs-12"><div class="bs-sidebar hidden-print" role="complementary">
   <h3>Documentation</h3>
   <ul class="nav bs-sidenav">
   
      
         
            <li class="main"><a title="README" href="../..#start">README</a></li>
         
      
   
      
         
         
      
   
      
         <li class="main ax-collapse ax-active" >
            <a class="ax-link"
               href="javascript:void(0)"
               title="API"
               data-toggle="collapse"
               data-target="#API"
               aria-expanded="false"
               aria-controls="collapseExample">API <span class="caret"></span></a>

            <ul class="nav subnav in"
               id="API">
               
               <li >
                  <a title="actions" href="../actions.js/#start">actions</a>
               </li>
               
               <li >
                  <a title="errors" href="../errors.js/#start">errors</a>
               </li>
               
               <li >
                  <a title="flags" href="../flags.js/#start">flags</a>
               </li>
               
               <li >
                  <a title="i18n" href="../i18n.js/#start">i18n</a>
               </li>
               
               <li >
                  <a title="json" href="../json.js/#start">json</a>
               </li>
               
               <li >
                  <a title="patches" href="../patches.js/#start">patches</a>
               </li>
               
               <li >
                  <a title="resources" href="../resources.js/#start">resources</a>
               </li>
               
               <li class="ax-active">
                  <a title="validation" href="./#start">validation</a>
               </li>
               
               <li >
                  <a title="visibility" href="../visibility.js/#start">visibility</a>
               </li>
               
            </ul>
         </li>
      
   
      
         <li class="main ax-collapse " >
            <a class="ax-link"
               href="javascript:void(0)"
               title="Patterns"
               data-toggle="collapse"
               data-target="#Patterns"
               aria-expanded="false"
               aria-controls="collapseExample">Patterns <span class="caret"></span></a>

            <ul class="nav subnav collapse"
               id="Patterns">
               
               <li >
                  <a title="Action Patterns" href="../../patterns/actions/#start">Action Patterns</a>
               </li>
               
               <li >
                  <a title="Error Handling Patterns" href="../../patterns/errors/#start">Error Handling Patterns</a>
               </li>
               
               <li >
                  <a title="Flag Patterns" href="../../patterns/flags/#start">Flag Patterns</a>
               </li>
               
               <li >
                  <a title="Resource Patterns" href="../../patterns/resources/#start">Resource Patterns</a>
               </li>
               
            </ul>
         </li>
      
   
    </ul>
</div></sidebar>
           <main class="col-sm-8 col-xs-12 " role="main">

<a name="start" class="ax-anchor"></a>
<h1 id="validation">validation</h1>
<p>This module provides helpers for patterns regarding <em>validateRequest</em>, <em>willValidate</em> and</p>
<p><em>didValidate</em> events.</p>
<p>Validation messages can have one of the following structures:</p>
<ul>
<li>A simple html message object (locale to string mapping). It will get a default level of <em>ERROR</em>.</li>
<li>A html message object as required by the messages widget consisting of a html message object under the
  key <em>htmlMessage</em> and a level under the key <em>level</em>.</li>
</ul>
<h2 id="contents">Contents</h2>
<p><strong>Module Members</strong></p>
<ul>
<li><a href="#successEvent">successEvent</a></li>
<li><a href="#errorEvent">errorEvent</a></li>
<li><a href="#handlerFor">handlerFor</a></li>
</ul>
<p><strong>Types</strong></p>
<ul>
<li><a href="#ValidationHandler">ValidationHandler</a><ul>
<li><a href="#ValidationHandler#registerResourceFromFeature">ValidationHandler#registerResourceFromFeature</a></li>
<li><a href="#ValidationHandler#registerResource">ValidationHandler#registerResource</a></li>
</ul>
</li>
</ul>
<h2 id="module-members">Module Members</h2>
<h4 id="successevent-resource-htmlmessages"><a name="successEvent"></a>successEvent( resource, htmlMessages )</h4>
<p>Creates and returns an event resembling a successful validation result.</p>
<h5 id="parameters">Parameters</h5>
<table>
<thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>resource</td>
<td><code>String</code></td>
<td>name of the validated resource</td>
</tr>
<tr>
<td>htmlMessages...</td>
<td><code>Array.&lt;Object&gt;</code>, <code>Object</code>, <code>Array.&lt;String&gt;</code>, <code>String</code></td>
<td>messages associated with the result. They should have the structure as described in the module</td>
</tr>
</tbody>
</table>
<h5 id="returns">Returns</h5>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Object</code></td>
<td>the validation event</td>
</tr>
</tbody>
</table>
<h4 id="errorevent-resource-htmlmessages"><a name="errorEvent"></a>errorEvent( resource, htmlMessages )</h4>
<p>Creates and returns an event resembling the result of a validation with errors.</p>
<h5 id="parameters_1">Parameters</h5>
<table>
<thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>resource</td>
<td><code>String</code></td>
<td>name of the validated resource</td>
</tr>
<tr>
<td>htmlMessages...</td>
<td><code>Array.&lt;Object&gt;</code>, <code>Object</code>, <code>Array.&lt;String&gt;</code>, <code>String</code></td>
<td>messages associated with the result. They should have the structure as described in the module</td>
</tr>
</tbody>
</table>
<h5 id="returns_1">Returns</h5>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Object</code></td>
<td>the validation event</td>
</tr>
</tbody>
</table>
<h4 id="handlerfor-context"><a name="handlerFor"></a>handlerFor( context )</h4>
<p>Creates and returns a new handler for <code>validateRequest</code> events for a given context. It handles sending
of <code>willValidate</code> and <code>didValidate</code> events, including the output of the given <code>validator</code> function.</p>
<h5 id="parameters_2">Parameters</h5>
<table>
<thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>context</td>
<td><code>Object</code></td>
<td>the context the handler should work with. It expects to find an <code>eventBus</code> property, with which it can do the event handling</td>
</tr>
</tbody>
</table>
<h5 id="returns_2">Returns</h5>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ValidationHandler</code></td>
<td>the validation handler instance for the given context</td>
</tr>
</tbody>
</table>
<h2 id="types">Types</h2>
<h3 id="validationhandler"><a name="ValidationHandler"></a>ValidationHandler</h3>
<h4 id="validationhandlerregisterresourcefromfeature-featurepath-validator-optionaloptions"><a name="ValidationHandler#registerResourceFromFeature"></a>ValidationHandler#registerResourceFromFeature( featurePath, validator, optionalOptions )</h4>
<p>Registers a validator for <code>validateRequest</code> events for a resource configured under the given feature.
It is assumed that the given feature has a <code>resource</code> property with the name of the resource to
validate. If the property is not found, an assertion will fail. If on the other hand the option
<code>isOptional</code> is given as <code>true</code>, this is ignored and nothing good or bad happens.</p>
<p>Apart from that this function works just like <a href="#ValidationHandler#registerResource">ValidationHandler#registerResource</a>.</p>
<p>Example:
Consider the following configuration for a widget:</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
   <span class="nt">&quot;features&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;amount&quot;</span><span class="p">:</span> <span class="p">{</span>
         <span class="nt">&quot;resource&quot;</span><span class="p">:</span> <span class="s2">&quot;theAmount&quot;</span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>An example using that would be:</p>
<div class="codehilite"><pre><span></span><span class="nx">validation</span><span class="p">.</span><span class="nx">handlerFor</span><span class="p">(</span> <span class="nx">context</span> <span class="p">)</span>
   <span class="p">.</span><span class="nx">registerResourceFromFeature</span><span class="p">(</span> <span class="s1">&#39;amount&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">meta</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span> <span class="nx">isAmountValid</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
         <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="s1">&#39;The given amount is not valid&#39;</span><span class="p">;</span>
   <span class="p">}</span> <span class="p">);</span>
</pre></div>


<h5 id="parameters_3">Parameters</h5>
<table>
<thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>featurePath</td>
<td><code>String</code></td>
<td>the feature to read the resource to validate from</td>
</tr>
<tr>
<td>validator</td>
<td><code>Function</code></td>
<td>the validator function called upon <code>validateRequest</code> for the given resource</td>
</tr>
<tr>
<td><em>optionalOptions</em></td>
<td><code>Object</code></td>
<td>options to use</td>
</tr>
<tr>
<td><em>optionalOptions.isOptional</em></td>
<td><code>Boolean</code></td>
<td>if <code>true</code> a non-configured feature is simply ignored. Otherwise this results in an error (default is <code>false</code>)</td>
</tr>
</tbody>
</table>
<h5 id="returns_3">Returns</h5>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ValidationHandler</code></td>
<td>this instance for chaining</td>
</tr>
</tbody>
</table>
<h4 id="validationhandlerregisterresource-resource-validator"><a name="ValidationHandler#registerResource"></a>ValidationHandler#registerResource( resource, validator )</h4>
<p>Registers a validator for <code>validateRequest</code> events for the given resource.</p>
<p>The validator must be a function, that handles the actual validation necessary for the resource. The
validation result is always signaled through one or more generated error messages or the absence of
these messages. So valid results may be a string, an i18n object, an array of the former, <code>null</code> or
an empty array. <code>null</code> and an empty array signal a successful validation.</p>
<p>The validator receives the event object for the <code>validateRequest</code> event and its according <code>meta</code> object.</p>
<p>The way these messages are returned by the validator may be one of two ways, depending on the nature
of the validation:</p>
<ul>
<li>if the validation can be handled synchronously, the result should simply be returned directly</li>
<li>in case the validation is asynchronous, a promise must be returned, which must be resolved with the
  same kind of values as for the synchronous case</li>
</ul>
<p>If the validator throws an error or the promise is rejected, this is treated as a failed validation.
Since this is due to a programming error, the error or rejection cause will be logged and a
configurable message will instead be send in the <code>didValidate</code> event. The message is assumed to be
found in the global configuration under the path <code>lib.laxar-patterns.validation.i18nHtmlExceptionMessage</code>
as string or i18n object. If it cannot be found, an empty string is send as message.</p>
<p>Example:</p>
<div class="codehilite"><pre><span></span><span class="nx">validation</span><span class="p">.</span><span class="nx">handlerFor</span><span class="p">(</span> <span class="nx">context</span> <span class="p">)</span>
   <span class="p">.</span><span class="nx">registerResource</span><span class="p">(</span> <span class="s1">&#39;theAmount&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">meta</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">context</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">theAmount</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">;</span>
   <span class="p">}</span> <span class="p">)</span>
   <span class="p">.</span><span class="nx">registerResource</span><span class="p">(</span> <span class="s1">&#39;currentUser&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">meta</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">fetchUserValidityRules</span><span class="p">()</span>
         <span class="p">.</span><span class="nx">then</span><span class="p">(</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">rules</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">context</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">currentUser</span><span class="p">.</span><span class="nx">meets</span><span class="p">(</span> <span class="nx">rules</span> <span class="p">);</span>
         <span class="p">}</span> <span class="p">)</span>
         <span class="p">.</span><span class="nx">then</span><span class="p">(</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">valid</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">valid</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="s1">&#39;The current user isn\&#39;t valid for some reason. Do something!&#39;</span><span class="p">;</span>
         <span class="p">}</span> <span class="p">);</span>
   <span class="p">}</span> <span class="p">);</span>
</pre></div>


<h5 id="parameters_4">Parameters</h5>
<table>
<thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>resource</td>
<td><code>String</code></td>
<td>the resource to validate</td>
</tr>
<tr>
<td>validator</td>
<td><code>Function</code></td>
<td>the validator function called upon <code>validateRequest</code> for the given resource</td>
</tr>
</tbody>
</table>
<h5 id="returns_4">Returns</h5>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ValidationHandler</code></td>
<td>this instance for chaining</td>
</tr>
</tbody>
</table></main>
        </div>
      </div>

      <footer>
   <div class="container">
      <div class="ax-copyright">
         <span>
            
         </span>

         <ul class="ax-social">
            
               <li><a class="fa fa-twitter-square" target="_blank" href="https://twitter.com/laxarjs"></a></li>
            
            
               <li><a class="fa fa-rss-square" target="_blank" title="Subscribe to our RSS-feed" href="http://laxarjs.org/rss"></a></li>
            
         </ul>
      </div>
   </div>
</footer>

      <script src="../../../laxar.theme/js/jquery-1.10.2.min.js"></script>
      <script src="../../../laxar.theme/js/bootstrap-3.0.3.min.js"></script>
      <script src="../../../laxar.theme/js/base.js"></script>
   </body>
</html>