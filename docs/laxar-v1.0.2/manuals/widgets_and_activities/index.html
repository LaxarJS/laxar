<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../laxar.theme/img/favicon.ico">
        <title>LaxarJS v1.0.2</title>

        <link rel="stylesheet" href="../../../laxar.theme/css/pygments.css">
        <link href="../../../laxar.theme/css/style.min.css" rel="stylesheet">

    </head>

    <body class="documentation">

      <header class="navbar  navbar-fixed-top" role="navigation">
    <div class="container">

        <div class="navbar-header navbar-inverse">
           <button class="navbar-toggle"
              type="button"
              data-toggle="collapse"
              data-target=".navbar-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
          </button>
            <!-- Main title -->
            <a class="navbar-brand" href="http://www.laxarjs.org">
               <span class="ax-laxar-logo">Laxar<span>JS</span></span>
            </a>
         </div>

         <div class="navbar-collapse collapse navbar-inverse">
            <ul class="nav navbar-nav nav-pills ax-dropdown">
   <li role="presentation" class="dropdown">
      <a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">
         laxar <span class="caret"></span>
      </a>
         
         <ul class="dropdown-menu">
            
            <li><a href="../../../laxar-latest">laxar</a></li>
            
            <li><a href="../../../laxar-patterns-latest">laxar-patterns</a></li>
            
            <li><a href="../../../laxar-uikit-latest">laxar-uikit</a></li>
            
            <li><a href="../../../laxar-mocks-latest">laxar-mocks</a></li>
            
            <li><a href="../../../laxar-loader-latest">laxar-loader</a></li>
            
            <li><a href="../../../laxar-tooling-latest">laxar-tooling</a></li>
            
            <li><a href="../../../laxar-angular-adapter-latest">laxar-angular-adapter</a></li>
            
            <li><a href="../../../laxar-angular2-adapter-latest">laxar-angular2-adapter</a></li>
            
            <li><a href="../../../laxar-react-adapter-latest">laxar-react-adapter</a></li>
            
            <li><a href="../../../laxar-vue-adapter-latest">laxar-vue-adapter</a></li>
            
            <li><a href="../../../generator-laxarjs-latest">generator-laxarjs</a></li>
            
            <li><a href="../../../generator-laxarjs2-latest">generator-laxarjs2</a></li>
            
            <li><a href="../../../grunt-laxar-latest">grunt-laxar</a></li>
            
         </ul>
         
   </li>
</ul>
            <ul class="nav navbar-nav nav-pills ax-dropdown">
   <li role="presentation" class="dropdown">
      <a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">
         v1.0.2 <span class="caret"></span>
      </a>
      
      <ul class="dropdown-menu">
         
            <li class="ax-dropdown-headline">Latest</li>
            
               <li><a href="../../../laxar-v2-latest">v2.0.3</a></li>
            
               <li><a href="../../../laxar-v1-latest">v1.3.5</a></li>
            
               <li><a href="../../../laxar-v0-latest">v0.26.2</a></li>
            
            <li role="separator" class="divider"></li>
         
         <li class="ax-dropdown-headline">All Releases</li>
         
            <li><a href="../../../laxar-v2.0.3">v2.0.3</a></li>
         
            <li><a href="../../../laxar-v2.0.2">v2.0.2</a></li>
         
            <li><a href="../../../laxar-v2.0.1">v2.0.1</a></li>
         
            <li><a href="../../../laxar-v2.0.0">v2.0.0</a></li>
         
            <li><a href="../../../laxar-v1.3.5">v1.3.5</a></li>
         
            <li><a href="../../../laxar-v1.3.4">v1.3.4</a></li>
         
            <li><a href="../../../laxar-v1.3.3">v1.3.3</a></li>
         
            <li><a href="../../../laxar-v1.3.2">v1.3.2</a></li>
         
            <li><a href="../../../laxar-v1.3.1">v1.3.1</a></li>
         
            <li><a href="../../../laxar-v1.3.0">v1.3.0</a></li>
         
            <li><a href="../../../laxar-v1.2.10">v1.2.10</a></li>
         
            <li><a href="../../../laxar-v1.2.9">v1.2.9</a></li>
         
            <li><a href="../../../laxar-v1.2.8">v1.2.8</a></li>
         
            <li><a href="../../../laxar-v1.2.7">v1.2.7</a></li>
         
            <li><a href="../../../laxar-v1.2.6">v1.2.6</a></li>
         
            <li><a href="../../../laxar-v1.2.5">v1.2.5</a></li>
         
            <li><a href="../../../laxar-v1.2.4">v1.2.4</a></li>
         
            <li><a href="../../../laxar-v1.2.3">v1.2.3</a></li>
         
            <li><a href="../../../laxar-v1.2.2">v1.2.2</a></li>
         
            <li><a href="../../../laxar-v1.2.1">v1.2.1</a></li>
         
            <li><a href="../../../laxar-v1.2.0">v1.2.0</a></li>
         
            <li><a href="../../../laxar-v1.1.0">v1.1.0</a></li>
         
            <li><a href="../../../laxar-v1.0.5">v1.0.5</a></li>
         
            <li><a href="../../../laxar-v1.0.4">v1.0.4</a></li>
         
            <li><a href="../../../laxar-v1.0.3">v1.0.3</a></li>
         
            <li><a href="../../../laxar-v1.0.2">v1.0.2</a></li>
         
            <li><a href="../../../laxar-v1.0.1">v1.0.1</a></li>
         
            <li><a href="../../../laxar-v1.0.0">v1.0.0</a></li>
         
            <li><a href="../../../laxar-v0.26.2">v0.26.2</a></li>
         
            <li><a href="../../../laxar-v0.26.1">v0.26.1</a></li>
         
            <li><a href="../../../laxar-v0.26.0">v0.26.0</a></li>
         
            <li><a href="../../../laxar-v0.25.1">v0.25.1</a></li>
         
            <li><a href="../../../laxar-v0.25.0">v0.25.0</a></li>
         
            <li><a href="../../../laxar-v0.24.0">v0.24.0</a></li>
         
            <li><a href="../../../laxar-v0.23.3">v0.23.3</a></li>
         
            <li><a href="../../../laxar-v0.23.2">v0.23.2</a></li>
         
            <li><a href="../../../laxar-v0.23.1">v0.23.1</a></li>
         
            <li><a href="../../../laxar-v0.23.0">v0.23.0</a></li>
         
            <li><a href="../../../laxar-v0.22.2">v0.22.2</a></li>
         
            <li><a href="../../../laxar-v0.22.1">v0.22.1</a></li>
         
            <li><a href="../../../laxar-v0.22.0">v0.22.0</a></li>
         
            <li><a href="../../../laxar-v0.21.0">v0.21.0</a></li>
         
            <li><a href="../../../laxar-v0.20.1">v0.20.1</a></li>
         
            <li><a href="../../../laxar-v0.20.0">v0.20.0</a></li>
         
            <li><a href="../../../laxar-v0.19.1">v0.19.1</a></li>
         
            <li><a href="../../../laxar-v0.19.0">v0.19.0</a></li>
         
            <li><a href="../../../laxar-v0.18.2">v0.18.2</a></li>
         
            <li><a href="../../../laxar-v0.18.1">v0.18.1</a></li>
         
            <li><a href="../../../laxar-v0.18.0">v0.18.0</a></li>
         
            <li><a href="../../../laxar-v0.17.1">v0.17.1</a></li>
         
            <li><a href="../../../laxar-v0.17.0">v0.17.0</a></li>
         
            <li><a href="../../../laxar-v0.16.2">v0.16.2</a></li>
         
            <li><a href="../../../laxar-v0.16.1">v0.16.1</a></li>
         
            <li><a href="../../../laxar-v0.16.0">v0.16.0</a></li>
         
            <li><a href="../../../laxar-v0.15.0">v0.15.0</a></li>
         
            <li><a href="../../../laxar-v0.14.0">v0.14.0</a></li>
         
            <li><a href="../../../laxar-v0.13.3">v0.13.3</a></li>
         
            <li><a href="../../../laxar-v0.13.2">v0.13.2</a></li>
         
            <li><a href="../../../laxar-v0.13.1">v0.13.1</a></li>
         
            <li><a href="../../../laxar-v0.13.0">v0.13.0</a></li>
         
            <li><a href="../../../laxar-v0.12.1">v0.12.1</a></li>
         
            <li><a href="../../../laxar-v0.12.0">v0.12.0</a></li>
         
            <li><a href="../../../laxar-v0.11.1">v0.11.1</a></li>
         
            <li><a href="../../../laxar-v0.11.0">v0.11.0</a></li>
         
            <li><a href="../../../laxar-v0.10.1">v0.10.1</a></li>
         
            <li><a href="../../../laxar-v0.10.0">v0.10.0</a></li>
         
            <li><a href="../../../laxar-v0.9.11">v0.9.11</a></li>
         
            <li><a href="../../../laxar-v0.9.10">v0.9.10</a></li>
         
            <li><a href="../../../laxar-v0.9.9">v0.9.9</a></li>
         
            <li><a href="../../../laxar-v0.9.8">v0.9.8</a></li>
         
            <li><a href="../../../laxar-v0.9.7">v0.9.7</a></li>
         
            <li><a href="../../../laxar-v0.9.6">v0.9.6</a></li>
         
            <li><a href="../../../laxar-v0.9.5">v0.9.5</a></li>
         
            <li><a href="../../../laxar-v0.9.4">v0.9.4</a></li>
         
            <li><a href="../../../laxar-v0.9.3">v0.9.3</a></li>
         
            <li><a href="../../../laxar-v0.9.2">v0.9.2</a></li>
         
            <li><a href="../../../laxar-v0.9.1">v0.9.1</a></li>
         
            <li><a href="../../../laxar-v0.9.0">v0.9.0</a></li>
         
      </ul>
      
   </li>
</ul>

            <ul class="nav navbar-nav">
               
                  
               
                  
                     <li >
                        <a href="../../CHANGELOG/">Changelog</a>
                     </li>
                  
               
                  
               
                  
               
                  
               
                  
               
                  
               
               
                <!-- Repo link -->
                
                <li>
                    <a class="ax-external" href="https://github.com/LaxarJS/laxar/tree/v1.0.2">
                       <i class="fa fa-github"></i> GitHub
                    </a>
                </li>
                
            </ul>
            <a class="ax-navbar-additional"
               target="_blank"
               href="http://laxarjs.github.io/widget-browser/#/widgetBrowser">Widgets</a>
        </div>
    </div>
</header>

      <div class="container content">
        <div class="row">
           <sidebar class="col-sm-4 col-xs-12"><div class="bs-sidebar hidden-print" role="complementary">
   <h3>Documentation</h3>
   <ul class="nav bs-sidenav">
   
      
         
            <li class="main"><a title="README" href="../..#start">README</a></li>
         
      
   
      
         
         
      
   
      
         
            <li class="main"><a title="LaxarJS Concepts" href="../../concepts/#start">LaxarJS Concepts</a></li>
         
      
   
      
         
            <li class="main"><a title="Why LaxarJS?" href="../../why_laxar/#start">Why LaxarJS?</a></li>
         
      
   
      
         <li class="main ax-collapse " >
            <a class="ax-link"
               href="javascript:void(0)"
               title="API"
               data-toggle="collapse"
               data-target="#API"
               aria-expanded="false"
               aria-controls="collapseExample">API <span class="caret"></span></a>

            <ul class="nav subnav collapse"
               id="API">
               
               <li >
                  <a title="assert" href="../../api/assert.js/#start">assert</a>
               </li>
               
               <li >
                  <a title="axId" href="../../api/id.js/#start">axId</a>
               </li>
               
               <li >
                  <a title="axLayout" href="../../api/layout.js/#start">axLayout</a>
               </li>
               
               <li >
                  <a title="axRuntimeServices" href="../../api/runtime_services.js/#start">axRuntimeServices</a>
               </li>
               
               <li >
                  <a title="axWidgetArea" href="../../api/widget_area.js/#start">axWidgetArea</a>
               </li>
               
               <li >
                  <a title="configuration" href="../../api/configuration.js/#start">configuration</a>
               </li>
               
               <li >
                  <a title="event_bus" href="../../api/event_bus.js/#start">event_bus</a>
               </li>
               
               <li >
                  <a title="file_resource_provider" href="../../api/file_resource_provider.js/#start">file_resource_provider</a>
               </li>
               
               <li >
                  <a title="flow" href="../../api/flow.js/#start">flow</a>
               </li>
               
               <li >
                  <a title="fn" href="../../api/fn.js/#start">fn</a>
               </li>
               
               <li >
                  <a title="i18n" href="../../api/i18n.js/#start">i18n</a>
               </li>
               
               <li >
                  <a title="log" href="../../api/log.js/#start">log</a>
               </li>
               
               <li >
                  <a title="object" href="../../api/object.js/#start">object</a>
               </li>
               
               <li >
                  <a title="object" href="../../api/string.js/#start">object</a>
               </li>
               
               <li >
                  <a title="storage" href="../../api/storage.js/#start">storage</a>
               </li>
               
               <li >
                  <a title="theme_manager" href="../../api/theme_manager.js/#start">theme_manager</a>
               </li>
               
            </ul>
         </li>
      
   
      
         <li class="main ax-collapse " >
            <a class="ax-link"
               href="javascript:void(0)"
               title="Contributing"
               data-toggle="collapse"
               data-target="#Contributing"
               aria-expanded="false"
               aria-controls="collapseExample">Contributing <span class="caret"></span></a>

            <ul class="nav subnav collapse"
               id="Contributing">
               
               <li >
                  <a title="LaxarJS Coding Styles" href="../../contributing/styleguide/#start">LaxarJS Coding Styles</a>
               </li>
               
            </ul>
         </li>
      
   
      
         <li class="main ax-collapse ax-active" >
            <a class="ax-link"
               href="javascript:void(0)"
               title="Manuals"
               data-toggle="collapse"
               data-target="#Manuals"
               aria-expanded="false"
               aria-controls="collapseExample">Manuals <span class="caret"></span></a>

            <ul class="nav subnav in"
               id="Manuals">
               
               <li >
                  <a title="Overview" href="../#start">Overview</a>
               </li>
               
               <li >
                  <a title="Controls and Libraries" href="../providing_controls/#start">Controls and Libraries</a>
               </li>
               
               <li >
                  <a title="Creating Themes" href="../creating_themes/#start">Creating Themes</a>
               </li>
               
               <li >
                  <a title="Creating an Adapter for a new Widget Technology" href="../adapters/#start">Creating an Adapter for a new Widget Technology</a>
               </li>
               
               <li >
                  <a title="Events and Publish-Subscribe" href="../events/#start">Events and Publish-Subscribe</a>
               </li>
               
               <li >
                  <a title="Flow and Places" href="../flow_and_places/#start">Flow and Places</a>
               </li>
               
               <li >
                  <a title="Infrastructure and Tools" href="../infrastructure_and_tools/#start">Infrastructure and Tools</a>
               </li>
               
               <li >
                  <a title="Installing Third Party Widgets" href="../installing_widgets/#start">Installing Third Party Widgets</a>
               </li>
               
               <li >
                  <a title="Internationalizing a Widget" href="../i18n/#start">Internationalizing a Widget</a>
               </li>
               
               <li >
                  <a title="LaxarJS Configuration in an Application" href="../configuration/#start">LaxarJS Configuration in an Application</a>
               </li>
               
               <li class="ax-active">
                  <a title="Widgets and Activities" href="./#start">Widgets and Activities</a>
               </li>
               
               <li >
                  <a title="Writing Compositions" href="../writing_compositions/#start">Writing Compositions</a>
               </li>
               
               <li >
                  <a title="Writing Pages" href="../writing_pages/#start">Writing Pages</a>
               </li>
               
            </ul>
         </li>
      
   
    </ul>
</div></sidebar>
           <main class="col-sm-8 col-xs-12 " role="main">

<a name="start" class="ax-anchor"></a>
<p><a href="../">« return to the manuals</a></p>
<p>Preliminary readings:</p>
<ul>
<li><a href="../../concepts/">LaxarJS Core Concepts</a></li>
</ul>
<h1 id="widgets-and-activities">Widgets and Activities</h1>
<p>Widgets and activities are the <em>"work horse"</em> of any LaxarJS application.
They make up the bulk of the user interface and provide all client-side application logic.</p>
<h2 id="widget-responsibilities">Widget Responsibilities</h2>
<p>Before starting to implement your widget, take a moment to think and delineate its responsibilities.
You can do this by phrasing the question: <em>What goal does this widget help the user to accomplish?</em>
Are you thinking about a very broadly applicable, technical task such as <em>"allow the user to enter a date"</em> or <em>"allow the user to delete a data row"</em>?
In this case you might want to implement this functionality as a <em>control</em> (an AngularJS directive or an HTML5 web component) and use it <em>within</em> one or more of your widgets.</p>
<p>Usually, widgets correspond to significant areas of the screen and are composed from multiple controls.
They are built with a <em>specific user-goal</em> in mind, such as <em>"allow the user to book a flight"</em> or <em>"allow the user to review shopping cart contents"</em>.
If widgets are made too small and too generic, page definitions will be confusing and the widget configuration options become unwieldy.
As a rule of the thumb, only very complex pages should contain more than a about a dozen widgets.
And who wants to have very complex pages anyway?</p>
<h3 id="when-to-use-activities">When to use Activities</h3>
<p>Activities are <em>"invisible widgets"</em> that are used to <em>fetch and manage application resources</em>.
Within the page, they may represent a REST API or a data store, fetching resources and performing relevant service calls (such as a form submission) upon action request.
This makes activities perform a role similar to AngularJS services.
The advantage over services is that using activities puts the <em>page author</em> in control over instantiation and configuration:
Individual widget instances may each be connected to their own activity instance, or share an event bus topic with a single instance.
Although these configurations are not impossible to achieve using AngularJS dependency injection and -services, using LaxarJS activities makes the connections declarative and visible.</p>
<p>Activities may also serve as a <em>mediator</em> between widgets that use mutually incompatible event vocabularies (such as different resource formats).
This may happen when integrating a widget from a third party into an application.</p>
<h2 id="how-to-create-a-widget">How to Create a Widget</h2>
<p>The easiest way to create a widget is to use the appropriate <em>grunt-init</em> template.
Check out the <a href="../../">README</a> on how to obtain the grunt-init templates and on creating an application.</p>
<p>Start by creating a sub-directory for your new widget within the LaxarJS application.
Each widget in an application lives within a sub-folder of the <em>widget root</em> (<code>includes/widgets</code> by default).
To change the widget root you can modify the RequireJS-path <code>'laxar-path-widgets'</code> in the require configuration.
The widget path <code>includes/widgets/shopping/cart-widget</code> is used as an example path throughout this manual.</p>
<p>The sub-directory <em>shopping</em> is the <em>widget category</em> in the example path.
Categories allow to organize widgets by their general business area, for example <em>shopping</em>, <em>social</em>, <em>finance</em> and so on.
The last component of the widget path is the <em>widget name</em>:
It has to be unique throughout an application and must be written in lower case letters with components separated by underscores.
Regular widget names always end in <code>_widget</code> whereas activities always end in <code>_activity</code>.</p>
<p>To create the actual widget, run:</p>
<div class="codehilite"><pre><span></span>grunt-init laxar-widget
</pre></div>


<p>A wizard will ask for some details on the widget such as license and author, but you can always edit this information in the widget sources afterwards.
In the following steps, it is assumed that you used the category <em>shopping</em> and the widget name <em>cart-widget</em> as above.</p>
<h3 id="widget-files">Widget Files</h3>
<p>A newly created widget contains the following files:</p>
<ul>
<li><code>widget.json</code></li>
</ul>
<p>This <em>widget specification</em> contains meta-data about your widget that is used by the LaxarJS framework.
  It allows you to describe the configuration options of your widget features as a JSON schema.</p>
<ul>
<li><code>bower.json</code></li>
</ul>
<p>This specifies the <em>dependencies</em> of your widget for use with <a href="http://bower.io/">Bower</a>.
  While not used directly by LaxarJS, it is the key to automated and isolated widget tests.</p>
<ul>
<li><code>cart-widget.js</code></li>
</ul>
<p>The <em>business logic</em> of your shopping cart (like calculating a total or changing item quantities) as an <em>AngularJS controller</em>.
  When your controller is instantiated by the LaxarJS runtime, it will receive an AngularJS scope (the model) and a reference to the event bus, which allows for communication with the world.
  When built for release, all controllers and their RequireJS-dependencies are bundled into a single, compressed JavaScript file.</p>
<ul>
<li><code>default.theme/cart-widget.html</code></li>
</ul>
<p>The <em>AngularJS HTML template</em> defining the <em>appearance</em> of your widget.
  When your widget is used on a page, LaxarJS will load this automatically and bind it to your widget controller's scope.
  The <a href="http://getbootstrap.com/css/">Bootstrap CSS</a> classes are available by convention to facilitate uniform styling across widgets.
  If Bootstrap does not suit you, feel free to use a different framework (or none at all), but keep in mind that this limits opportunities for widget reuse.
  Similarly to controllers, all widget templates will be preloaded within a single JSON file when your application is packaged for release.</p>
<ul>
<li><code>default.theme/(s)css/cart-widget.(s)css</code></li>
</ul>
<p>Widget-specific <em>style definitions</em>.
  Most of the time, your widget is fine just using CSS style definitions from the global application theme.
  In this case, it can do completely without CSS (or <a href="http://sass-lang.com/">SCSS</a> folders.
  Sometimes though, you have style definitions which are widget-specific (such as CSS animations) and should not be part of the global theme.
  If your widget has its own CSS file, the framework will load it when the widget is used in an application, and bundle it for release.</p>
<p>LaxarJS supports to change the appearance of an existing widget by overriding its template or its CSS styles from within a custom <em>theme</em>.
It is also possible to put shared style definitions (CSS classes and SCSS variables) as well as shared assets like fonts and images into that theme.
To get started with some simple styling, you do not have to concern yourself with themes or SCSS.
However they are very useful for adapting widgets to different applications and web sites.
Read <a href="../creating_themes/">more about themes</a> once you are familiar with creating and using widgets.</p>
<h3 id="widget-files-for-testing">Widget Files for Testing</h3>
<p>The sub folder <code>spec</code> contains the widget spec test and associated resources.
None of these files are loaded during regular application runtime:</p>
<ul>
<li><code>spec/spec_runner.html</code></li>
</ul>
<p>For convenience, LaxarJS provides a spec runner for each new widget, to run jasmine spec tests in the browser.
  This file does not need to be touched at all.</p>
<ul>
<li><code>spec/spec_runner.js</code></li>
</ul>
<p>Configuration for the spec test.
  This file needs to be modified only if widget-specific external dependencies are required during testing.</p>
<ul>
<li><code>spec/cart-widget.spec.js</code></li>
</ul>
<p>This is the actual <a href="http://jasmine.github.io/1.3/introduction.html">jasmine</a> spec test.
  The test harness (providing a simulated LaxarJS event bus) has already been prepared for you.</p>
<h3 id="implementing-a-controller">Implementing a Controller</h3>
<p>To write the controller for your widget, you will need to implement some business logic.
For a very simple shopping cart this means</p>
<ul>
<li>
<p>summing the contents of the cart</p>
</li>
<li>
<p>increasing or decreasing the quantity of individual positions within the cart.</p>
</li>
</ul>
<p>The grunt-init template has already created an empty controller along with some AngularJS infrastructure (module and injections).
For a shopping cart, this might be an appropriate starting implementation based on some dummy data:</p>
<div class="codehilite"><pre><span></span><span class="c1">// ...</span>

<span class="kd">function</span> <span class="nx">Controller</span><span class="p">(</span> <span class="nx">$scope</span> <span class="p">)</span> <span class="p">{</span>
   <span class="nx">$scope</span><span class="p">.</span><span class="nx">model</span> <span class="o">=</span> <span class="p">[</span>
      <span class="p">{</span> <span class="nx">label</span><span class="o">:</span> <span class="s1">&#39;Dairy Dreams&#39;</span><span class="p">,</span> <span class="nx">price</span><span class="o">:</span> <span class="mf">5.25</span><span class="p">,</span> <span class="nx">amount</span><span class="o">:</span> <span class="mi">1</span> <span class="p">},</span>
      <span class="p">{</span> <span class="nx">label</span><span class="o">:</span> <span class="s1">&#39;Milky Mocha&#39;</span><span class="p">,</span> <span class="nx">price</span><span class="o">:</span> <span class="mf">12.75</span><span class="p">,</span> <span class="nx">amount</span><span class="o">:</span> <span class="mi">3</span> <span class="p">},</span>
      <span class="p">{</span> <span class="nx">label</span><span class="o">:</span> <span class="s1">&#39;Freezing Frappé&#39;</span><span class="p">,</span> <span class="nx">price</span><span class="o">:</span> <span class="mf">18.25</span><span class="p">,</span> <span class="nx">amount</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span>
   <span class="p">];</span>

   <span class="nx">$scope</span><span class="p">.</span><span class="nx">increment</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">item</span> <span class="p">)</span> <span class="p">{</span>
      <span class="o">++</span><span class="nx">item</span><span class="p">.</span><span class="nx">amount</span><span class="p">;</span>
   <span class="p">};</span>

   <span class="nx">$scope</span><span class="p">.</span><span class="nx">decrement</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">item</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">item</span><span class="p">.</span><span class="nx">amount</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">item</span><span class="p">.</span><span class="nx">amount</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">);</span>
   <span class="p">};</span>

   <span class="nx">$scope</span><span class="p">.</span><span class="nx">total</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">rows</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">rows</span><span class="p">.</span><span class="nx">reduce</span><span class="p">(</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">acc</span><span class="p">,</span> <span class="nx">next</span> <span class="p">)</span> <span class="p">{</span>
         <span class="k">return</span> <span class="nx">acc</span> <span class="o">+</span> <span class="nx">next</span><span class="p">.</span><span class="nx">price</span><span class="o">*</span><span class="nx">next</span><span class="p">.</span><span class="nx">amount</span><span class="p">;</span>
      <span class="p">},</span> <span class="mi">0</span> <span class="p">);</span>
   <span class="p">};</span>
<span class="p">}</span>

<span class="c1">// ...</span>
</pre></div>


<p>We can see that a widget controller in LaxarJS works just like any other AngularJS controller.
Of course things will get more interesting once you use the event bus to receive shopping cart contents from somewhere else, or to signal that an order should be placed.</p>
<h3 id="creating-a-template">Creating a Template</h3>
<p>The purpose of creating an HTML template is to provide your widget with an appearance on the screen.
For anyone familiar with Bootstrap and AngularJS, most of this should not be a surprise:</p>
<div class="codehilite"><pre><span></span><span class="p">&lt;</span><span class="nt">h4</span> <span class="na">ng-bind-html</span><span class="o">=</span><span class="s">&quot;features.headline.htmlText&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">h4</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;table&quot;</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">thead</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>Beverage<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">th</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;cart-price&quot;</span><span class="p">&gt;</span>Price<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">th</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;cart-amount&quot;</span><span class="p">&gt;</span>Amount<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
   <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
   <span class="p">&lt;/</span><span class="nt">thead</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">tfoot</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">th</span> <span class="na">colspan</span><span class="o">=</span><span class="s">&quot;3&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;cart-price&quot;</span><span class="p">&gt;</span>{{ total( model ) }}<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
   <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
   <span class="p">&lt;/</span><span class="nt">tfoot</span><span class="p">&gt;</span>
   <span class="p">&lt;</span><span class="nt">tr</span> <span class="na">ng-repeat</span><span class="o">=</span><span class="s">&quot;item in model&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ item.label }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">td</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;cart-amount&quot;</span><span class="p">&gt;</span>{{ item.amount }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">td</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;cart-price&quot;</span><span class="p">&gt;</span>{{ item.price }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
         <span class="p">&lt;</span><span class="nt">button</span> <span class="na">data-ng-click</span><span class="o">=</span><span class="s">&quot;decrement( item )&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-xs&quot;</span><span class="p">&gt;&lt;</span><span class="nt">i</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;fa fa-minus&quot;</span> <span class="p">/&gt;&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
         <span class="p">&lt;</span><span class="nt">button</span> <span class="na">data-ng-click</span><span class="o">=</span><span class="s">&quot;increment( item )&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-xs&quot;</span><span class="p">&gt;&lt;</span><span class="nt">i</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;fa fa-plus&quot;</span> <span class="p">/&gt;&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
   <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
</pre></div>


<p>Note that the LaxarJS runtime will wrap the DOM of each widget within a single DIV container.
The scope of the template is the same as for the controller so that <code>model</code>, <code>decrement</code>, <code>increment</code> and <code>total</code> will be available upon template instantiation.
The <code>features</code> property used within the headline comes from the <em>widget configuration</em>, which is described below.</p>
<h3 id="adding-some-style">Adding Some Style</h3>
<p>A widget may be styled using CSS.
LaxarJS supports generating the CSS from SCSS source files, allowing to place common definitions for font size, color and much more within a shared "theme" folder.
To keep things simple, you can ignore SCSS and themes for now and simply write a CSS file for your widget, in our case under <code>default.theme/css/cart-widget.css</code>.
Once you are familiar with the basics, read the article on <a href="../creating_themes/">creating themes</a> for more information.</p>
<p>Thanks to Bootstrap this widget does not require a lot of fancy styling:</p>
<div class="codehilite"><pre><span></span><span class="p">.</span><span class="nc">cart-widget</span> <span class="p">.</span><span class="nc">cart-amount</span><span class="o">,</span>
<span class="p">.</span><span class="nc">cart-widget</span> <span class="p">.</span><span class="nc">cart-price</span> <span class="p">{</span>
   <span class="k">text-align</span><span class="p">:</span> <span class="kc">right</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>For best encapsulation, selectors should be prefixed with the widget class (<code>cart-widget</code>) as shown here.
LaxarJS automatically adds this class to the widget container, so there is no need to specify it in the widget template.
It is also recommended to prefix custom CSS classes as shown here (<code>cart-amount</code>, <code>cart-price</code>), just as you would prefix custom AngularJS elements or attributes when creating a directive.
This makes widget styles more robust against changes in Bootstrap or other third party CSS.</p>
<h3 id="configuration-options">Configuration Options</h3>
<p>When looking at the template, you might have wondered where the <code>features.headline.htmlText</code> came from.
This is a <em>feature configuration</em> option of our widget:
We want to be able to control the headline text for each instance of our widget.
For this reason, we make it configurable by adding a feature entry to the <code>widget.json</code>:</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
   <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;CartWidget&quot;</span><span class="p">,</span>
   <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Allows Users to Review and Modify Purchase Items&quot;</span><span class="p">,</span>

   <span class="nt">&quot;features&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;$schema&quot;</span><span class="p">:</span> <span class="s2">&quot;http://json-schema.org/draft-04/schema#&quot;</span><span class="p">,</span>
      <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
      <span class="nt">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
         <span class="nt">&quot;headline&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
            <span class="nt">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
               <span class="nt">&quot;htmlText&quot;</span><span class="p">:</span> <span class="p">{</span>
                  <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
                  <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;The HTML headline content.&quot;</span>
               <span class="p">}</span>
            <span class="p">}</span>
         <span class="p">}</span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>The <em>widget features</em> are a <a href="http://json-schema.org">JSON schema</a> document that is used by LaxarJS to verify pages.
It contains a property for each configurable feature, and it also allows to specify default values as needed.
This makes it easy to provide self-documenting customization options for your widget.
See the <a href="#reference">reference section</a> for details on the widget specification.</p>
<h3 id="checking-out-the-result">Checking out the Result</h3>
<p>Before we can take a look at the widget, we will need to integrate it into the page provided by the application template (<code>application/pages/page1.json</code>).</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
   <span class="nt">&quot;layout&quot;</span><span class="p">:</span> <span class="s2">&quot;one_column&quot;</span><span class="p">,</span>

   <span class="nt">&quot;areas&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;activities&quot;</span><span class="p">:</span> <span class="p">[],</span>
      <span class="nt">&quot;header&quot;</span><span class="p">:</span> <span class="p">[],</span>
      <span class="nt">&quot;content&quot;</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
             <span class="nt">&quot;widget&quot;</span><span class="p">:</span> <span class="s2">&quot;shopping/cart-widget&quot;</span><span class="p">,</span>
             <span class="nt">&quot;features&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="nt">&quot;headline&quot;</span><span class="p">:</span> <span class="p">{</span>
                   <span class="nt">&quot;htmlText&quot;</span><span class="p">:</span> <span class="s2">&quot;My Shopping Cart&quot;</span>
                <span class="p">}</span>
             <span class="p">}</span>
          <span class="p">}</span>
      <span class="p">],</span>
      <span class="nt">&quot;footer&quot;</span><span class="p">:</span> <span class="p">[]</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>There is another manual to learn more about <a href="../writing_pages/">writing pages</a>.</p>
<p>Now we can start the development web server provided by LaxarJS, from the application root:</p>
<div class="codehilite"><pre><span></span>npm install <span class="c1"># if you have not already</span>
npm start
</pre></div>


<p>Navigate to <code>http://localhost:8000/debug.html</code> to admire the fruits of your labor:</p>
<p><img alt="CartWidget" src="../widgets_and_activities/cart_widget.png" /></p>
<p>Now that you have learned the basics in creating widgets, take a closer look at widget testing.</p>
<h2 id="testing-a-widget">Testing a Widget</h2>
<p>One of the major goals of LaxarJS is to simplify the development <em>and testing</em> of isolated components.
For this reason, the testing infrastructure for your widget has already been added when using <code>grunt-init</code>.</p>
<h3 id="writing-spec-tests">Writing Spec-Tests</h3>
<p>LaxarJS contains a testing infrastructure to mock out the LaxarJS runtime, effectively running your widget in a sandbox or <em>test bed</em> as it is called in LaxarJS.
A skeleton spec is already provided for you:
It contains code to prepare the test bed with sample configuration and to instantiate your controller.</p>
<p>To mock out AngularJS services such as <code>$http</code> you can work with <a href="https://docs.angularjs.org/api/ngMock">ngMocks</a> just like you would do without LaxarJS.
To add a simple test for our widget, replace the existing dummy test</p>
<div class="codehilite"><pre><span></span><span class="nx">it</span><span class="p">(</span> <span class="s1">&#39;still needs some tests.&#39;</span> <span class="p">);</span>
</pre></div>


<p>with a more useful spec:</p>
<div class="codehilite"><pre><span></span><span class="nx">it</span><span class="p">(</span> <span class="s1">&#39;allows to calculate a total of its contents&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">expect</span><span class="p">(</span> <span class="nx">testBed_</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">total</span><span class="p">(</span> <span class="nx">testBed_</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">model</span> <span class="p">)</span> <span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span> <span class="mf">61.75</span> <span class="p">);</span>
<span class="p">}</span> <span class="p">);</span>
</pre></div>


<p>Tests get more interesting when you instrument the testbed to publish mock events to be handled by the widget controller, and in turn to inspect events published by the widget.
For more details on testing event bus communication, refer to the <a href="../events/">article on events</a>.</p>
<h3 id="running-the-test">Running the Test</h3>
<p>Now make sure that the development web server is still running and check out the test results using the <a href="http://localhost:8000/includes/widgets/shopping/cart-widget/spec/spec_runner.html">provided spec runner</a>:</p>
<p><img alt="CartWidget" src="../widgets_and_activities/cart_widget_spec.png" /></p>
<p>Alternatively, you can run the tests for all your widgets from the command line:</p>
<div class="codehilite"><pre><span></span><span class="nx">npm</span> <span class="nx">test</span>
</pre></div>


<p>LaxarJS provides <a href="https://github.com/LaxarJS/grunt-laxar">grunt tasks</a> for testing that automatically set up and run <a href="http://phantomjs.org/">PhantomJS</a> for you, so you should not run into problems accessing the DOM.
Hopefully this makes it simple to set up continuous integration for your application.</p>
<p><a name="reference"></a></p>
<h2 id="laxarjs-widget-reference">LaxarJS Widget Reference</h2>
<p>Building on top of the basics covered so far, sometimes it is helpful to know about all the options available to widget authors.
This section covers the details of the widget specification format and of the LaxarJS test bed.</p>
<h3 id="the-widget-scope">The Widget Scope</h3>
<p>The widget controller and the template have access to the widget scope.
The scope may be used by widget controllers to communicate with directives such as <code>ngForm</code>.
To avoid entanglement, multiple widgets (even if nested) do <em>not</em> communicate through the scope but <em>always use the event bus</em> for this.</p>
<ul>
<li><code>$scope.eventBus</code></li>
</ul>
<p>Most of the time, this is the only LaxarJS scope property used by widget controllers.
  Of course, controllers will almost always add their own properties.</p>
<ul>
<li><code>$scope.widget.id</code></li>
</ul>
<p>A unique identifier for this widget within the page.
  You can use it to generate unique DOM IDs, for example to connect <code>label</code> and <code>input</code> elements in an HTML form.</p>
<h3 id="the-widget-specification-format">The Widget Specification Format</h3>
<p>Each widget has a <code>widget.json</code> file which is also called <em>widget specification</em>.
LaxarJS contains a <a href="../../../static/schemas/widget.json">widget schema definition</a> that defines the exact format of this file.
These are the most important widget properties:</p>
<ul>
<li><code>name</code></li>
</ul>
<p>This required field contains the <em>CamelCase</em> version of the widget's directory name.</p>
<ul>
<li><code>description</code></li>
</ul>
<p>What this widget is about.
  Ideally, this contains the main <em>user-goal</em> mentioned in the first section.</p>
<ul>
<li><code>features</code></li>
</ul>
<p>The widget features.
  This is a JSON schema document that documents all configurable widget features.
  For each widget instance used on a page, LaxarJS will check the feature configuration of that instance against this schema.
  This also allows to provide default values for configuration options.</p>
<ul>
<li><code>compatibility</code></li>
</ul>
<p>An optional list of new LaxarJS features that this widget is compatible with.
  It allows individual widgets to <em>opt in</em> to breaking LaxarJS changes (similarly to the Python <em>import from future</em> construct), without harming widgets that do not yet support these changes.</p>
<ul>
<li><code>controls</code></li>
</ul>
<p>An optional list of LaxarJS controls used by this widget.
  Each control is represented by its RequireJS path.
  This allows the LaxarJS runtime to automatically load the AngularJS modules and CSS styles associated with these controls whenever your widget is used.
  Refer to <a href="../providing_controls/">Providing Controls</a> for on loading user interface components and their resources in this manner.</p>
<h3 id="the-laxarjs-widget-test-bed">The LaxarJS Widget Test Bed</h3>
<p>The LaxarJS spec test boilerplate (provided for you by grunt-init) creates a <code>testBed_</code> instance which is re-initialized prior to running each test case.
It has the following essential properties.</p>
<ul>
<li><code>testBed_.featuresMock</code></li>
</ul>
<p>Contains the feature configuration for use during the spec test, to be specified by the author of the test.
  It has the same format that would be provided through the page definition within an actual application.
  Note that <code>featuresMock</code> must be set before calling <code>testBed_.setup()</code>.</p>
<ul>
<li><code>testBed_.setup()</code></li>
</ul>
<p>Creates the widget controller.
  Afterwards, the <code>testBed_.scope</code> is available.
  This simulates navigating to a page that contains an instance of the widget under test.</p>
<ul>
<li><code>testBed_.tearDown()</code></li>
</ul>
<p>Destroys the widget controller.
  This is the testing equivalent to navigating away from the page that contains the widget instance.</p>
<ul>
<li><code>testBed_.scope</code></li>
</ul>
<p>The AngularJS scope that was created for this widget.
  This allows to inspect widget state in white-box tests.</p>
<ul>
<li><code>testBed_.eventBusMock</code></li>
</ul>
<p>A handle to the LaxarJS event bus that allows spec tests to simulate other widgets on the same page.
  Through it, the spec test can publish events for manipulating the widget, and in turn subscribe to events published by the widget controller.
  This is different from the <code>testBed_.scope.eventBus</code> handle which is used by the widget controller.
  Tests may use <code>spyOn</code> on the scope event bus to monitor widget behaviour directly, or interact with the <code>eventBusMock</code> to communicate with the widget indirectly.</p></main>
        </div>
      </div>

      <footer>
   <div class="container">
      <div class="ax-copyright">
         <span>
            
         </span>

         <ul class="ax-social">
            
               <li><a class="fa fa-twitter-square" target="_blank" href="https://twitter.com/laxarjs"></a></li>
            
            
               <li><a class="fa fa-rss-square" target="_blank" title="Subscribe to our RSS-feed" href="http://laxarjs.org/rss"></a></li>
            
         </ul>
      </div>
   </div>
</footer>

      <script src="../../../laxar.theme/js/jquery-1.10.2.min.js"></script>
      <script src="../../../laxar.theme/js/bootstrap-3.0.3.min.js"></script>
      <script src="../../../laxar.theme/js/base.js"></script>
   </body>
</html>